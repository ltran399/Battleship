(()=>{"use strict";const e=10,t=[{name:"Carrier",size:5},{name:"Battleship",size:4},{name:"Cruiser",size:3},{name:"Submarine",size:3},{name:"Destroyer",size:2}],s="setup",i="playing";class a{static createEmptyBoard(){return Array(e).fill().map((()=>Array(e).fill(null)))}static isValidPlacement(t,s,i,a,r){if(r){if(a+s.size>e)return!1;for(let e=0;e<s.size;e++)if(null!==t[i][a+e])return!1}else{if(i+s.size>e)return!1;for(let e=0;e<s.size;e++)if(null!==t[i+e][a])return!1}return!0}static placeShip(e,t,s,i,a){const r=e.map((e=>[...e]));if(a)for(let e=0;e<t.size;e++)r[s][i+e]=t.name;else for(let e=0;e<t.size;e++)r[s+e][i]=t.name;return r}}class r{constructor(){this.board=a.createEmptyBoard(),this.playerID=playerID,this.shots=new Set}receiveAttack(e,t){const s=`${e},${t}`;return this.shots.has(s)?null:(this.shots.add(s),null!==this.grid[e][t])}isAllShipsSunk(){const e=t.reduce(((e,t)=>e+t.size),0);let s=0;return this.shots.forEach((e=>{const[t,i]=e.split(",").map(Number);null!==this.gird[t][i]&&s++})),s===e}}class n{constructor(){this.ships=[...t],this.selectedShip=null,this.orientation="horizontal"}selectShip(e){this.selectedShip=this.ships.find((t=>t.name===e))}removeShip(e){this.ships=this.ships.filter((t=>t.name!==e))}rotateShip(){this.orientation="horizontal"===this.orientation?"vertical":"horizontal"}hasShipsRemaining(){return this.ships.length>0}}class l{constructor(){this.state=s,this.currentPlayer=1,this.player1Board=new r(1),this.player2Board=new r(2),this.player1Ships=new n,this.player2Ships=new n,this.ui=null}setUI(e){this.ui=e}handleCellClick(e,t){this.state===s?this.handleShipPlacement(e,t):this.state===i&&this.handleShot(e,t)}handleShipPlacement(e,t){const s=1===this.currentPlayer?this.player1Ships:this.player2Ships,r=1===this.currentPlayer?this.player1Board:this.player2Board;s.selectedShip&&a.isValidPlacement(r.grid,s.selectedShip,e,t,"horizontal"===s.orientation)&&(r.grid=a.placeShip(r.grid,s.selectedShip,e,t,"horizontal"===s.orientation),s.removeShip(s.selectedShip.name),s.selectedShip=null,s.hasShipsRemaining()||(1===this.currentPlayer?(this.currentPlayer=2,this.ui.updateMessage("Player 2, place your ships")):(this.state=i,this.currentPlayer=1,this.ui.updateMessage("Player 1, take your shot"))),this.ui.updateBoards(),this.ui.updateShipList())}handleShot(e,t){const s=1===this.currentPlayer?this.player2Board:this.player1Board,i=s.receiveAttack(e,t);if(null!==i){if(i){if(this.ui.updateMessage("Hit!"),s.isAllShipsSunk())return this.state="game_over",this.ui.updateMessage(`Player ${this.currentPlayer} wins!`),void this.ui.showPlayAgainButton()}else this.ui.updateMessage("Miss!");this.currentPlayer=1===this.currentPlayer?2:1,this.ui.updateBoards()}}reset(){this.state=s,this.currentPlayer=1,this.player1Board=new r(1),this.player2Board=new r(2),this.player1Ships=new n,this.player2Ships=new n,this.ui.reset()}}class h{constructor(e){this.game=e,this.setupEventListeners()}setupEventListeners(){document.getElementById("rotateBtn").addEventListener("click",(()=>{(1===this.game.currentPlayer?this.game.player1Ships:this.game.player2Ships).rotateShip()})),document.getElementById("playAgain").addEventListener("click",(()=>{this.game.reset()})),this.setupBoards(),this.updateShipList()}setupBoards(){["player1Board","player2Board"].forEach(((t,s)=>{const i=document.getElementById(t);i.innerHTML="";for(let t=0;t<e;t++)for(let s=0;s<e;s++){const e=document.createElement("div");e.className="cell",e.dataset.row=t,e.dataset.col=s,e.addEventListener("click",(()=>{this.game.handleCellClick(t,s)})),i.appendChild(e)}}))}updateBoards(){this.updatePlayerBoard(1),this.updatePlayerBoard(2)}updatePlayerBoard(t){const s=1===t?this.game.player1Board:this.game.player2Board,i=document.getElementById(`player${t}Board`).getElementsByClassName("cell");for(let a=0;a<e;a++)for(let r=0;r<e;r++){const n=i[a*e+r],l=null!==s.grid[a][r],h=`${a},${r}`,d=s.shots.has(h);n.className="cell",!l||t!==this.game.currentPlayer&&this.game.state!==GAME_STATES.SETUP||n.classList.add("ship"),d&&(n.classList.add(l?"hit":"miss"),n.textContent=l?"×":"○")}}updateShipList(){const e=document.getElementById("shipList"),t=1===this.game.currentPlayer?this.game.player1Ships:this.game.player2Ships;e.innerHTML="",t.ships.forEach((s=>{const i=document.createElement("button");i.textContent=`${s.name} (${s.size})`,i.addEventListener("click",(()=>{t.selectShip(s.name),document.getElementById("rotateBtn").classList.remove("hidden")})),e.appendChild(i)}))}updateMessage(e){document.getElementById("message").textContent=e}showPlayAgainButton(){document.getElementById("playAgain").classList.remove("hidden")}reset(){this.updateMessage("Player 1, place your ships"),document.getElementById("playAgain").classList.add("hidden"),document.getElementById("rotateBtn").classList.add("hidden"),this.setupBoards(),this.updateShipList()}}document.addEventListener("DOMContentLoaded",(()=>{const e=new l,t=new h(e);e.setUI(t),t.updateMessage("Player 1, place your ships")}))})();